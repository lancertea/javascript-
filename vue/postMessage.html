<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>string</title>
</head>

<body>
    <script>
const postMessage = (data:string):void=>{
    
}
const listen = (cb:(data:string)=>void):void=>{

}
JSON.stringify
JSON.parse
// window1

const api = {
    foo(name:string){
        return name+' world'
    }
}
listen(data=>{
    let param = JSON.parse(data);
    let res = api.foo(param);
    postMessage(res)
});


 

// window2
let id = 0;
const map = new Map<string,(arg:any)=>void>();
const request = (name:string,data:any):Promise<any>=>{
    return new Promise((resolve,reject)=>{

    let param = JSON.stringify({
        name,
        id:id++,
        data,
    });
    postMessage(param);
    map.set(id,resolve)
}

listen(({name,data,id})=>{
    map.get(id)?.(data)
})

request('foo','hello')//Promise --> 'hello world'

window.postMessage(()=>{})


    


    </script>

</body>

</html>