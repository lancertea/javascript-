<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>闭包</title>

</head>

<body>
    <script>
        //函数作为返回值

        function create() {
            const a = 100
            return function () {
                console.log(a)
            }
        }

        const fn = create()
        const a = 200
        fn() // 100

        // 函数作为参数被传递
        // function print(fn) {
        //     const a = 200
        //     fn()
        // }
        // const a = 100
        // function fn() {
        //     console.log(a)
        // }
        // print(fn) // 100

        // 所有的自由变量的查找，是在函数定义的地方，向上级作用域查找
        // 不是在执行的地方！！！


        //闭包
        {
            function example() {
                var count = 0;
                return function () {
                    return ++count;
                }
            }

            var getCount = example();
            console.log(getCount()); //1
            console.log(getCount()); //2

            // 闭包隐藏数据，只提供 API
            function createCache() {
                const data = {} // 闭包中的数据，被隐藏，不被外界访问
                return {
                    set: function (key, val) {
                        data[key] = val
                    },
                    get: function (key) {
                        return data[key]
                    }
                }
            }

            const c = createCache()
            c.set('a', 100)
            console.log(c.get('a')) //100
        }
        //私有变量
        {
            var Person = function (_name, _age) {
                this.name = _name;
                var age = _age;
                this.getName = function () {
                    return this.name;
                };
                this.setName = function (_name) {
                    this.name = _name;
                };
                this.getAge = function () {
                    return age;
                };
                this.setAge = function (_age) {
                    age = _age;
                };
            }

            var p1 = new Person('zz', 12);
            console.log(p1.getName()); //'zz'
            console.log(p1.getAge()); //12

            p1.name = 'ss';
            p1.age = 7;
            console.log(p1.getName()); //'ss'
            console.log(p1.getAge()); //12


        }
        //定时器传参
        {
            function foo(param) {
                return function () {
                    console.log(param);

                };
            }
            var bar = foo(111);
            setTimeout(bar, 100);
        }

        //网站访问计数、广告点击地址
        //如果设置成对象，以对象属性方式访问，很容易被外面改
        {
            
            var tracker = (function () {
                var accessCounter = 0;
                var adAccess=[];
                // 模块化  module.exports={}  用这句替换return
                return {
                    increaseAccessCounter: function () {
                        accessCounter++;
                    },
                    getAccessCounter(){
                        return accessCounter;
                    },
                    storeAccessPage:function(page){
                       adAccess.push(page); 
                    },
                    checkAccessPage:function(){
                        return adAccess;
                    }
                };
            })();
           tracker.increaseAccessCounter();
           tracker.increaseAccessCounter();
           console.log(tracker.getAccessCounter());

           var page1="http://xxx.com/yyy.html";
           var page2="http://xxx.com/zzz.html";

           tracker.storeAccessPage(page1);
           tracker.storeAccessPage(page2);

           console.log(tracker.checkAccessPage());
           

           

        }
    </script>
</body>

</html>