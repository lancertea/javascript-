<!doctype html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>this</title>

</head>

<body>


</body>

<script>
    //this
    var foo = {
        x: 10
    };

    var bar = {
        x: 20,
        test: function () {

            console.log(this === bar);
            console.log(this.x);

            // this = foo; 错误，任何时候不能改变this的值


        }
    };

    bar.test(); // true, 20

    foo.test = bar.test;
    foo.test(); // false, 10



    function f1() {
        console.log(this);
    }

    f1(); // window

    /*
     because
        var f1Reference = {
            base: global,
            propertyName: 'f1'
        };
        */
    console.log(f1 === f1.prototype.constructor); // true

    // 另外一种形式的调用表达式

    f1.prototype.constructor(); // f1.prototype

    /*
    because

    var f1PrototypeConstructorReference = {
        base: f1.prototype,
        propertyName: 'constructor'
    };
    */



    //this 相关面试题：
    { //1
        var name = '222';
        var a = {
            name: '111',
            say: function () {
                console.log(this.name);

            }
        }
        var fun = a.say;
        fun(); //222
        a.say(); //111

        var b = {
            name: '333',
            say: function (func) {
                func();
            }
        }
        //是因为b的say函数中是直接调用的func（），虽然是在b内，但是func在执行的时候并没有绑定在某个对象上，相当于是全局状况下调用，所以打印 ”222“
        b.say(a.say); //222
        b.say = a.say;
        b.say(); //333
    } {
        //2
        var name = '123';

        function print() {
            var name = '456';
            this.name = '789';
            console.log(name);

        }
        print(); //'456'
        //print()这种调用方式的this是window
    } {
        //3
        var name = 123;

        function print1() {
            this.name = 234;
            console.log(name);

        }
        print1(); //234
        console.log(new print1()); //Object { name: 234 }
    } {
        //4
        var a = 5;

        function test1() {
            a = 0;
            console.log(a);
            console.log(this.a);
            var a; //声明会提前
            console.log(a);

        }
        test1(); //0 , 5, 0
        console.log(new test1()); //0 , undefined, 0
    } {
        var q = {
            name: 'qq',
            show: function () {
                return this;
            }
        };

        var q1 = {
            name: 'qq1',
            show: function () {
                return q.show()
            }
        };
        console.log(q1.show()); //Object { name: "qq", show: show()}

        var q2 = {
            name: 'qq2',
            show: function () {
                var st = q.show;
                return st()
            }
        };
        console.log(q2.show()); //window


    }

    {
        var q = {
            name: 'qq',
            show: function () {
                setTimeout(function () {
                    console.log(this); //window

                }, 1000);
            }
        };
        q.show();

        //this在箭头函数里没有指向，所以他得去外面找
        var q1 = {
            name: 'qq',
            show: function () {
                console.log(this); //q1
                setTimeout(() => {
                    console.log(this); //q1

                }, 1000);
            }
        };
        q1.show();
    }

    {
        function foo(a, b) {
            console.log(this);
            console.log(a);
            console.log(b);
        }

        var xc = {
            name: 'xiecheng',
            age: 33
        };

        foo.call(xc, 2, 3);
        foo.apply(xc, [2, 3]);
        //foo.bind(xc)(2,3);
        foo.bind(xc, 2, 3)();

        //这三个函数常用场景：
        //call:将类数组变成数组：
        function convertArgs() {
            console.log(arguments); //类数组
            console.log(Array.isArray(arguments));
            var args = Array.prototype.slice.call(arguments);
            console.log(args);
            console.log(Array.isArray(args)); //true


        }
        convertArgs(1, 2, 3, 4);

        //apply:求数组的最小值
        console.log(Math.min(1,2,3,4));//1
        console.log(Math.min([1,2,3,4]));//NaN
        console.log(Math.min.apply(null,[1,2,3,4]));//1
       

        //bind:借用方法
        var obj1={
            data:[1,2,3],
            printF:function(){
                if(this.data.length){
                    return this.data[0];
                }
            }
        };
        console.log(obj1.printF());
        
        var obj2={
            data:[4,5,6],
            printS:function(){
                if(this.data.length>1){
                    return this.data[1];
                }
            }
        };
        console.log(obj2.printS());
        var getS=obj2.printS.bind(obj1);
        console.log(getS());
        
        
        


    }
</script>

</html>