<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>正则相关练习题</title>
</head>


<body>


    <script>
        {
            //实现一个字符串匹配算法，从字符串 S 中，查找是否存在字符串 T，若存在返回所在位置，
            //不存在返回-1！（如果不能基于indexOf/includes等内置的方法，你会如何处理呢？）
            String.prototype.myIndexOf = function (T) {
                //=>THIS:S
                let reg = new RegExp(T),
                    res = reg.exec(this);
                return res === null ? -1 : res.index;
            }

            let S = 'hello,my love',
                T = 'love';
            console.log(S.myIndexOf(T));
        }

        {
            //一个url后面好多key:value，如localhost?key=val&key2=val2&key3=val3，
            //封装一个函数 getParam(‘key’) 通过key获得相应等号后面的值
            //var url="locallhost?key1=val1&key2=val2&key3=val3";
            //console.log(url.getParam("key3")); //=>'val3'
            String.prototype.getParam = function (key) {
                let obj = {},
                    _this = this,
                    start = _this.indexOf('?');
                if (start === -1) {
                    return;
                }
                let str = _this.slice(start + 1);
                str.split('&').forEach(item => {
                    let [key, value] = item.split('=');
                    obj[key] = value;
                });
                return obj[key];
            }

            function queryURLParams() {
                let obj = {};
                this.replace(/([^?=&#]+)=([^?=&#]+)/g, (...[, $1, $2]) => obj[$1] = $2);
                this.replace(/#([^?=&#]+)/g, (...[, $1]) => obj['HASH'] = $1);
                return obj;
            }

            var url = "locallhost?key1=val1&key2=val2&key3=val3";
            console.log(url.getParam("key3"));
        }

        {
            //编写一个方法execAll，执行一次可以把所有匹配的结果捕获到（前提正则一定要设置全局修饰符g）
            RegExp.prototype.execAll = function (str) {
                if (!this.global) {
                    return this.exec(str);
                }
                let res = [],
                    restr;
                while (restr = reg.exec(str)) {
                    res.push(restr[0]);
                }
                return res.length ? res : null;

            }

            let reg = /\d+/g;
            console.log(reg.execAll("去年2019@2020今年@未来2021"));
            //=>字符串中的MATCH方法，可以在执行一次的情况下，捕获到所有匹配的数据（前提：正则也得设置G才可以）
            console.log("去年2019@2020今年@未来2021".match(reg));
        }

        //百度一面
        //实现ES6模板字符串的功能
        //参考https://www.cnblogs.com/axu1997/p/12633582.html
        {
            let data = {
                name: 'zsy',
                date: '2020/4/12',
                address: '科技园'
            }
            let str = '${name}同学你好，你的面试时间为${date},面试地点为${address},请准时参加';
            //arr=str.match(/\$\{(\w+)\}/g)
            //Array(3) [ "${name}", "${date}", "${address}" ]

            function templateFunc(str, data) {
                let reg = /\$\{(\w+)\}/g;
                let arr = [];
                while (arr = reg.exec(str)) {
                    str = str.replace(arr[0], data[arr[1]]);
                }
                return str;
            }
            console.log(templateFunc(str, data));

            let str1 = str.replace(/\$\{(\w+)\}/g, (...arg) => {
                let [context, $1] = arg;
                context = data[$1];
                return context;
            })
            console.log(str1);
        }

        {
            //单词首字母大写
            let str = "good good study，day day up！";
            let reg = /\b([a-zA-Z])[a-zA-Z]*\b/g;
            str = str.replace(reg, (...arg) => {
                let [context, $1] = arg;
                $1 = $1.toUpperCase();
                context = context.slice(1);
                return $1 + context;
            })
            console.log(str);
        }

        {
            // 验证一个字符串中那个字母出现的次数最多，多少次？
            let str = "zhufengpeixunzhoulaoshi";
            str = str.split('').sort((a, b) => a.localeCompare(b)).join('');
            let arr = str.match(/([a-zA-Z])\1*/g).sort((a, b) => b.length - a.length);
            let max = arr[0].length,
                res = [arr[0][0]];
            for (let i = 1; i < arr.length; i++) {
                if (arr[i].length === max) {
                    res.push(arr[i][0])
                } else {
                    break;
                }
            }
            console.log(res, max);
        }

        //格式化金钱
        {
            String.prototype.millimeter = function () {
                return this.replace(/\d{1,3}(?=(\d{3})+$)/g, content => content + ',');
            }
            //如果没有提供initialValue，reduce 会从索引1的地方开始执行 callback 方法，跳过第一个索引。
            //如果提供initialValue，从索引0开始。
            function format(str) {
                // var str = num + '';
                //[ "4", "5", "9", "8",  "2", "6", "5", "1"]
                return str.split("").reverse().reduce((prev, next, index) => {
                    return ((index % 3) ? next : (next + ',')) + prev;
                })
            }

            let num = "15628954"; //=>"15,628,954" 千分符
            console.log(num.millimeter());
            console.log(format(num));
            num = "112345678256874"; //=>"12,345,678,256,874"
            console.log(num.millimeter());
            console.log(format(num));
        }

        {
            //如何把一个字符串的大小写取反（大写变小写小写变大写），例如 ’AbC' 变成 'aBc'
            //A-Z (65-90)

            let str = '123aCedBBB';
            str = str.replace(/[a-zA-Z]/g, item => {
                return item.toUpperCase() === item ? item.toLowerCase() : item.toUpperCase();
            })
            console.log(str);
        }
        
        //验证ip地址
        {
            function matchIp(str) {
            let reg = /^(\d+).(\d+).(\d+).(\d+)$/;
            if (reg.test(str)) {
                let arr = str.match(reg).splice(1, 5);
                return arr.every(item => {
                    return item >= 0 && item <= 255;
                })

            }
        }
        let ip = "0.123.255.0";
        console.log(matchIp(ip));

        }


    </script>
</body>

</html>